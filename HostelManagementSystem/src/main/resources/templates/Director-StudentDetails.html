<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Details</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" th:href="@{/images/Logo.png}" type="image/x-icon" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom font */
        body { font-family: 'Inter', sans-serif; }

        /* Sidebar Transitions */
        .sidebar { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 flex h-screen overflow-hidden">

<div id="sidebar" class="w-64 bg-blue-100 shadow-lg p-6 flex flex-col justify-between rounded-r-lg transition-transform transform lg:translate-x-0 -translate-x-full fixed lg:static z-20 h-full">
    <div>
        <div>
            <div class="p-4 flex items-center border-b border-blue-200 justify-center">
                <img th:src="@{/images/logo.png}" alt="Hostel Logo" class="w-20 h-20 object-contain border-none shadow-none outline-none">
            </div>
        </div>
        <nav class="space-y-4 mt-4">
            <a href="/Director-AccomodationDivision-dashboard"
               class="w-full py-2 bg-white text-black rounded-full font-semibold hover:bg-blue-300 flex items-center justify-start px-4 space-x-2 transition duration-200">
                <i class="fas fa-home mr-3"></i> Dashboard
            </a>
            <a href="/Director-Allocation_History"
               class="w-full py-2 bg-white text-black rounded-full font-semibold hover:bg-blue-300 flex items-center justify-start px-4 space-x-2 transition duration-200">
                <i class="fas fa-history mr-3"></i> Allocation History
            </a>
            <a href="/Director-User_management"
               class="w-full py-2 bg-white text-black rounded-full font-semibold hover:bg-blue-300 flex items-center justify-start px-4 space-x-2 transition duration-200">
                <i class="fas fa-users mr-3"></i> User Management
            </a>
            <a href="/Director-StudentDetails"
               class="w-full py-2 bg-blue-500 text-white rounded-full font-semibold hover:bg-blue-600 flex items-center justify-start px-4 space-x-2 transition duration-200">
                <i class="fas fa-graduation-cap mr-3"></i> Student Details
            </a>

            <a th:href="@{/director/inbox}"
               th:classappend="${tab == 'inbox'} ? 'bg-blue-500 text-white shadow-md' : 'bg-white text-black'"
               class="w-full py-2 rounded-full font-semibold hover:bg-blue-300 flex items-center justify-start px-4 space-x-2 transition duration-200 relative">
                <i class="fas fa-inbox mr-3"></i> Inbox

                <span id="sidebar-badge" th:if="${unreadCount != null and unreadCount > 0}" th:text="${unreadCount}"
                      class="absolute top-1 right-2 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">
                </span>
            </a>

        </nav>
    </div>
    <footer>
        <div class="text-center mb-6 px-4">
            <a href="/logout"
               class="w-full py-2 bg-white text-black rounded-full font-bold hover:bg-blue-400 focus:outline-none flex items-center justify-center space-x-2">
                <img th:src="@{/images/LogOut.png}" alt="Logout Icon" class="w-5 h-5 -rotate-90" />
                <span>Log Out</span>
            </a>
        </div>
    </footer>
</div>

<div id="overlay" class="fixed inset-0 bg-black opacity-50 z-10 hidden lg:hidden"></div>

<div class="flex-1 flex flex-col overflow-hidden">

    <div class="flex-1 p-4 md:p-8 overflow-y-auto">

        <div class="bg-blue-200 rounded-lg shadow p-6 mb-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <button id="toggle-btn" class="lg:hidden text-2xl focus:outline-none text-gray-700 hover:text-blue-600 transition">
                        <i class="fas fa-bars"></i>
                    </button>
                    <img th:src="@{/images/UniversityLogo.png}" alt="University Logo" class="w-10 h-10 md:w-12 md:h-12 object-contain" />
                    <div>
                        <h1 class="text-lg md:text-xl font-bold text-gray-800">HMS - UNIVERSITY OF PERADENIYA</h1>
                        <p class="text-xs md:text-sm text-blue-800 font-medium hidden sm:block">Director Accommodation Division</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">

            <h2 class="text-xl md:text-2xl font-bold text-gray-700 mb-6 border-b pb-3 flex items-center">
                <i class="fas fa-graduation-cap mr-2 text-blue-500"></i> Student Details Overview
            </h2>

            <form th:action="@{/Director-StudentDetails/search}" method="get" class="mb-8 flex flex-col sm:flex-row gap-4">
                <input type="text" name="regNo"
                       placeholder="Search by Student ID (e.g., S/16/xxx)"
                       class="flex-1 border border-gray-300 rounded-lg p-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700"
                       required>

                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-search mr-2"></i> Search
                </button>
            </form>

            <div th:if="${student}" class="border border-gray-200 rounded-xl shadow-sm p-6 bg-blue-50/50">

                <h3 class="text-xl font-bold mb-6 text-blue-800 flex items-center gap-2 border-b border-blue-200 pb-2">
                    <i class="fas fa-user-circle"></i>
                    Student Information
                </h3>

                <div class="space-y-4 text-sm md:text-base">

                    <div class="flex flex-col sm:flex-row sm:items-start border-b border-gray-100 pb-2 last:border-0">
                        <span class="font-semibold text-gray-600 sm:w-40 mb-1 sm:mb-0">Full Name</span>
                        <span class="hidden sm:block text-gray-400 mr-2">:</span>
                        <span class="text-gray-900 font-medium flex-1" th:text="${student.name}"></span>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:items-start border-b border-gray-100 pb-2 last:border-0">
                        <span class="font-semibold text-gray-600 sm:w-40 mb-1 sm:mb-0">Student ID</span>
                        <span class="hidden sm:block text-gray-400 mr-2">:</span>
                        <span class="text-gray-900 font-medium flex-1" th:text="${student.studentId}"></span>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:items-start border-b border-gray-100 pb-2 last:border-0">
                        <span class="font-semibold text-gray-600 sm:w-40 mb-1 sm:mb-0">Faculty</span>
                        <span class="hidden sm:block text-gray-400 mr-2">:</span>
                        <span class="text-gray-900 font-medium flex-1" th:text="${student.faculty}"></span>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:items-start border-b border-gray-100 pb-2 last:border-0">
                        <span class="font-semibold text-gray-600 sm:w-40 mb-1 sm:mb-0">Email</span>
                        <span class="hidden sm:block text-gray-400 mr-2">:</span>
                        <span class="text-gray-900 font-medium flex-1 break-all" th:text="${student.email}"></span>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:items-start border-b border-gray-100 pb-2 last:border-0">
                        <span class="font-semibold text-gray-600 sm:w-40 mb-1 sm:mb-0">Home Address</span>
                        <span class="hidden sm:block text-gray-400 mr-2">:</span>
                        <span class="text-gray-900 font-medium flex-1" th:text="${student.address}"></span>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:items-start pt-2">
                        <span class="font-semibold text-gray-600 sm:w-40 mb-1 sm:mb-0">Hostel</span>
                        <span class="hidden sm:block text-gray-400 mr-2">:</span>
                        <span class="flex-1">
                            <span th:if="${student.currentHostel}" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-check-circle mr-1"></i>
                                <span th:text="${student.currentHostel}"></span>
                            </span>
                            <span th:unless="${student.currentHostel}" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-times-circle mr-1"></i> Not Allocated
                            </span>
                        </span>
                    </div>

                </div>
            </div>

            <div th:if="${searchAttempted}" th:unless="${student}"
                 class="flex flex-col items-center justify-center py-12 border-2 border-dashed border-red-200 bg-red-50 rounded-xl text-center">
                <div class="bg-red-100 p-4 rounded-full mb-4">
                    <i class="fas fa-user-times text-3xl text-red-500"></i>
                </div>
                <h3 class="text-lg font-semibold text-red-700">Student Not Found</h3>
                <p class="text-red-500 text-sm mt-1">We couldn't find any student matching that ID.</p>
            </div>

            <div th:unless="${searchAttempted}"
                 class="flex flex-col items-center justify-center py-12 border-2 border-dashed border-gray-200 rounded-xl text-center">
                <div class="bg-blue-50 p-4 rounded-full mb-4">
                    <i class="fas fa-search text-3xl text-blue-400"></i>
                </div>
                <p class="text-gray-500 font-medium">Enter a Student ID above to view details.</p>
            </div>

        </div>
    </div>

    <div class="mt-auto border-t border-gray-200 py-6 px-8">
        <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-500">
            <p>&copy; 2025 HMS - University of Peradeniya. All rights reserved.</p>
        </div>
    </div>
</div>

<script>
    // Sidebar Toggle Logic
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggle-btn');
    const overlay = document.getElementById('overlay');

    toggleBtn.addEventListener('click', () => {
        const isOpen = !sidebar.classList.contains('-translate-x-full');
        if(isOpen) {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        } else {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        }
    });

    overlay.addEventListener('click', () => {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
    });

    document.addEventListener("DOMContentLoaded", function() {
        updateSidebarBadge();
    });

    function updateSidebarBadge() {
        // අපි කලින් Controller එකේ හදාගත්ත endpoint එකට call කරනවා
        fetch('/director/getNotificationCount')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(count => {
                // Sidebar එකේ Inbox Link එක සොයාගැනීම
                // Note: ඔබේ sidebar එකේ inbox link එකේ href එක හරියටම "/director/inbox" විය යුතුයි
                const inboxLink = document.querySelector('a[href="/director/inbox"]');

                if (inboxLink) {
                    // දැනට badge එකක් තියෙනවද බලනවා
                    let badge = document.getElementById('sidebar-badge');

                    if (count > 0) {
                        if (!badge) {
                            // Badge එක නැත්නම් අලුතින් හදනවා
                            badge = document.createElement('span');
                            badge.id = 'sidebar-badge';
                            // Tailwind CSS classes (ඔබේ Inbox page එකේ තිබුනු විදියටම)
                            badge.className = 'absolute top-1 right-2 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full';
                            inboxLink.appendChild(badge);
                        }
                        // Count එක update කරනවා
                        badge.innerText = count;
                    } else {
                        // Count එක 0 නම් සහ badge එකක් තියෙනවා නම් එය ඉවත් කරනවා
                        if (badge) {
                            badge.remove();
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error fetching notification count:', error);
            });
    }
</script>

</body>
</html>